#!/bin/bash

# Parse arguments.
while getopts 'hp:' argument
do
  case $argument in
    h)
      echo "usage: $0 [options] <additional files>"
      echo 'Commit changes in the PKGBUILD to an AUR distribution branch.'
      echo ' -h           show this help text'
      echo ' -p <script>  file to use in place of PKGBUILD'
      exit ;;
    p) pkgbuild="$OPTARG" ;;
    \?) exit 1 ;;
  esac
done
shift $(($OPTIND - 1))

# Generate missing .SRCINFO.
if ! [[ " $@ " =~ " .SRCINFO " ]]
then
  mksrcinfo ${pkgbuild:+"$pkgbuild"}
fi

# Update the branch denoted by the pkgbase.
exec offbranch \
  -b "aur/$(grep -Po "(?<=pkgbase = ).*" .SRCINFO)" \
  "${pkgbuild:-PKGBUILD}:PKGBUILD" .SRCINFO "$@"
