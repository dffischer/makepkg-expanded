#!/bin/bash

# Parse arguments.
print_help() {
  echo "usage: $0 <package> [name]"
  echo "       $0 -h"
  echo 'Set up git remote and branch pointing to AUR package repository.'
  exit 1
}

case $# in
  0) print_help ;;
  1) [ "$1" == -h ] && print_help ;;
  2) ;;
  *)
    gettext -sd git "Too many arguments."
    exit 1 ;;
esac

readonly master="refs/heads/master"
readonly name="${2:-aur/$1}"


# Set up remote.
git remote add -t master "$name" "ssh://aur@aur4.archlinux.org/${1}.git"

# Restrict parameterless pushes to the branch.
git config "remote.${name}.push" "refs/heads/$name:$master"

# Make branch track remote master.
git config "branch.${name}.remote" "$name"
git config "branch.${name}.merge" "$master"

# Pull in missing branch.
git rev-parse --verify --quiet "$name" > /dev/null || \
  git fetch "$name" "$master:refs/heads/$name"
